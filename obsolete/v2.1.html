<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adam's AI UI | Document Processing</title>
    <link rel="icon" type="image/x-icon" href="https://img.icons8.com/?size=100&id=XNotH4e8lEuO&format=png&color=000000">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github.min.css">
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.1/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #f3f4f6;
            --dark: #1f2937;
            --light: #ffffff;
            --gray: #9ca3af;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --sidebar-width: 320px;
            --sidebar-collapsed-width: 50px;
            --transition-speed: 0.3s;
            --header-height: 80px;
            --input-height: 80px;
            --controls-height: 70px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            padding: 0;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            width: 100%;
            height: 100vh;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--light);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            transition: width var(--transition-speed) ease;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 10;
            height: 100vh;
        }
        
        .sidebar.collapsed {
            width: var(--sidebar-collapsed-width);
        }
        
        .sidebar-header {
            padding: 20px;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: var(--header-height);
            flex-shrink: 0;
        }
        
        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
        }
        
        .toggle-sidebar {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }
        
        .toggle-sidebar:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            height: calc(100vh - var(--header-height));
        }
        
        .sidebar-section {
            margin-bottom: 25px;
            opacity: 1;
            transition: opacity var(--transition-speed) ease;
        }
        
        .sidebar.collapsed .sidebar-section {
            opacity: 0;
            pointer-events: none;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            color: var(--primary-dark);
            font-weight: 600;
            font-size: 1rem;
        }
        
        .section-header i {
            margin-right: 10px;
            font-size: 1.1rem;
        }
        
        .section-content {
            padding-left: 28px;
        }
        
        .info-text {
            line-height: 1.6;
            color: var(--dark);
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .info-text p {
            margin-bottom: 10px;
        }
        
        .api-config-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-group label {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--dark);
        }
        
        #api-key-input, #endpoint-input, #model-input {
            padding: 10px 15px;
            border: 1px solid var(--gray);
            border-radius: 8px;
            outline: none;
            font-size: 0.9rem;
            transition: border-color 0.3s;
        }
        
        #api-key-input:focus, #endpoint-input:focus, #model-input:focus {
            border-color: var(--primary);
        }
        
        #save-config {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
            margin-top: 5px;
        }
        
        #save-config:hover {
            background: var(--primary-dark);
        }
        
        .cf-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            padding: 8px 12px;
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.05);
            font-size: 0.85rem;
        }
        
        .cf-status i {
            font-size: 1rem;
            width: 16px;
        }
        
        .cf-status.success {
            color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }
        
        .cf-status.error {
            color: var(--error);
            background: rgba(239, 68, 68, 0.1);
        }
        
        code {
            background: rgba(0, 0, 0, 0.05);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.85em;
        }
        
        ul, ol {
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        li {
            margin-bottom: 5px;
            line-height: 1.5;
        }
        
        a {
            color: var(--primary);
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        /* Document Upload Area */
        .document-upload {
            padding: 15px;
            background: var(--light);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .upload-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }
        
        .upload-title {
            font-weight: 600;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .upload-content {
            display: none;
            flex-direction: column;
            gap: 10px;
        }
        
        .upload-content.expanded {
            display: flex;
        }
        
        .drop-area {
            border: 2px dashed var(--gray);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        .drop-area:hover, .drop-area.active {
            border-color: var(--primary);
        }
        
        .drop-area i {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .drop-text {
            margin-bottom: 10px;
        }
        
        .file-input {
            display: none;
        }
        
        .browse-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }
        
        .browse-btn:hover {
            background: var(--primary-dark);
        }
        
        .file-preview {
            margin-top: 15px;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: var(--secondary);
            border-radius: 6px;
            margin-bottom: 8px;
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        
        .file-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary);
            color: white;
            border-radius: 4px;
        }
        
        .file-details {
            flex: 1;
            overflow: hidden;
        }
        
        .file-name {
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .file-size {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .file-content {
            font-size: 0.8rem;
            margin-top: 5px;
            color: var(--dark);
            background: rgba(0, 0, 0, 0.05);
            padding: 8px;
            border-radius: 4px;
            max-height: 100px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: monospace;
        }
        
        .file-remove {
            background: none;
            border: none;
            color: var(--error);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px;
        }
        
        .file-remove:hover {
            color: #dc2626;
        }
        
        /* Main Content Styles */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
            background: var(--light);
            border-radius: 0;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            height: 100vh;
        }
        
        header {
            background: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            height: var(--header-height);
            flex-shrink: 0;
        }
        
        h1 {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .logo {
            font-size: 1.5rem;
            margin-right: 10px;
        }
        
        .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .api-status {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            font-size: 0.8rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 20px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--gray);
            margin-right: 6px;
        }
        
        .status-dot.connected {
            background: var(--success);
        }
        
        .status-dot.error {
            background: var(--error);
        }
        
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            height: calc(100vh - var(--header-height) - var(--input-height) - var(--controls-height) - 60px);
        }
        
        .message {
            max-width: 85%;
            padding: 15px 20px;
            border-radius: 18px;
            line-height: 1.5;
            animation: fadeIn 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .message-content {
            overflow-wrap: break-word;
        }
        
        .message-content pre {
            background: rgba(0, 0, 0, 0.05);
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 10px 0;
            position: relative;
        }
        
        .copy-button {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.8rem;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .run-button {
            position: absolute;
            bottom: 8px;
            right: 70px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.8rem;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .message-content pre:hover .copy-button,
        .message-content pre:hover .run-button {
            opacity: 1;
        }
        
        .copy-button:hover {
            background: var(--primary-dark);
        }
        
        .run-button:hover {
            background: #0da271;
        }
        
        .copy-button.copied {
            background: var(--success);
        }
        
        .message-content code {
            font-family: 'Fira Code', monospace;
            font-size: 0.9em;
            background: rgba(0, 0, 0, 0.05);
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .message-content pre code {
            background: none;
            padding: 0;
        }
        
        .message-content h1, 
        .message-content h2, 
        .message-content h3 {
            margin-top: 15px;
            margin-bottom: 10px;
        }
        
        .message-content p {
            margin-bottom: 10px;
        }
        
        .message-content ul, 
        .message-content ol {
            margin-left: 20px;
            margin-bottom: 10px;
        }
        
        .message-content blockquote {
            border-left: 4px solid #ddd;
            padding-left: 15px;
            margin: 15px 0;
            color: #666;
        }
        
        .message-content table {
            border-collapse: collapse;
            width: 100%;
            margin: 15px 0;
        }
        
        .message-content th, 
        .message-content td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        
        .message-content th {
            background-color: #f5f5f5;
        }
        
        .thinking-header {
            font-weight: bold;
            color: #6366f1;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .thinking-message {
            background-color: #f8f9fa;
            border-left: 4px solid #6366f1;
            padding: 12px 15px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
            font-style: italic;
            color: #495057;
        }

        .thinking-message pre {
            font-style: normal;
            background: rgba(0, 0, 0, 0.05);
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 10px 0;
        }

        .thinking-message code {
            font-family: 'Fira Code', monospace;
            font-size: 0.9em;
            background: rgba(0, 0, 0, 0.05);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .thinking-message pre code {
            background: none;
            padding: 0;
        }

        .final-answer-header {
            font-weight: bold;
            color: #10b981;
            margin: 15px 0 8px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .final-answer {
            background-color: #f0fdf4;
            border-left: 4px solid #10b981;
            padding: 12px 15px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            align-self: flex-end;
            background: var(--primary);
            color: white;
            border-bottom-right-radius: 4px;
        }
        
        .ai-message {
            align-self: flex-start;
            background: var(--secondary);
            color: var(--dark);
            border-bottom-left-radius: 4px;
        }
        
        .message-info {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 5px;
            display: block;
        }
        
        .input-container {
            padding: 16px;
            background: var(--light);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 10px;
            flex-shrink: 0;
            height: var(--input-height);
        }
        
        #user-input {
            flex: 1;
            padding: 14px 20px;
            border: 1px solid var(--gray);
            border-radius: 24px;
            outline: none;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        #user-input:focus {
            border-color: var(--primary);
        }
        
        #send-button {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 24px;
            padding: 0 24px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        #send-button:hover {
            background: var(--primary-dark);
        }
        
        #send-button:disabled {
            background: var(--gray);
            cursor: not-allowed;
        }
        
        .typing-indicator {
            display: none;
            align-self: flex-start;
            background: var(--secondary);
            color: var(--dark);
            padding: 12px 16px;
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            margin-bottom: 10px;
        }
        
        .typing-indicator.active {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .dot {
            width: 6px;
            height: 6px;
            background: var(--dark);
            border-radius: 50%;
            opacity: 0.6;
            animation: pulse 1.5s infinite;
        }
        
        .dot:nth-child(2) {
            animation-delay: 0.5s;
        }
        
        .dot:nth-child(3) {
            animation-delay: 1s;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.5); }
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            padding: 0 20px 15px 20px;
            height: var(--controls-height);
            align-items: center;
        }
        
        .control-group {
            display: flex;
            gap: 10px;
        }
        
        #clear-chat, #save-pdf, #view-sessions {
            background: var(--gray);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        #clear-chat:hover {
            background: var(--error);
        }
        
        #save-pdf {
            background: var(--success);
        }
        
        #save-pdf:hover {
            background: #0da271;
        }
        
        #view-sessions {
            background: var(--primary);
        }
        
        #view-sessions:hover {
            background: var(--primary-dark);
        }
        
        .hidden {
            display: none;
        }
        
        .pdf-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            display: none;
        }
        
        .pdf-loading .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
                height: auto;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                max-height: 60px;
                overflow: hidden;
                transition: max-height var(--transition-speed) ease;
            }
            
            .sidebar.expanded {
                max-height: 70vh;
                overflow-y: auto;
            }
            
            .sidebar.collapsed {
                width: 100%;
                max-height: 60px;
            }
            
            .sidebar.collapsed .sidebar-section {
                display: none;
            }
            
            .main-content {
                height: auto;
                min-height: calc(100vh - 60px);
            }
            
            .chat-container {
                height: auto;
                min-height: calc(100vh - var(--header-height) - var(--input-height) - var(--controls-height) - 60px);
            }
            
            .message {
                max-width: 90%;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .api-status {
                position: relative;
                top: 0;
                right: 0;
                justify-content: center;
                margin-top: 10px;
            }
            
            header {
                padding: 15px;
            }
            
            .controls {
                flex-direction: column;
                height: auto;
                padding: 15px 20px;
            }
            
            .control-group {
                width: 100%;
                justify-content: space-between;
            }
            
            .document-upload {
                padding: 10px;
            }
            
            .drop-area {
                padding: 15px;
            }
            
            .file-content {
                max-height: 80px;
            }
        }
        
        /* Fallback styles for code highlighting if hljs fails */
        .hljs-fallback {
            color: #24292e;
            background: #f6f8fa;
        }
        
        .hljs-fallback .hljs-keyword {
            color: #d73a49;
        }
        
        .hljs-fallback .hljs-string {
            color: #032f62;
        }
        
        .hljs-fallback .hljs-function {
            color: #6f42c1;
        }
        
        .hljs-fallback .hljs-comment {
            color: #6a737d;
        }
        
        .hljs-fallback .hljs-number {
            color: #005cc5;
        }
        
        .hljs-fallback .hljs-tag {
            color: #22863a;
        }
        
        .error-message {
            background-color: #fee;
            color: #c33;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #c33;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">Configuration Panel</div>
                <button class="toggle-sidebar" id="toggle-sidebar">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <div class="sidebar-content">
                <div class="sidebar-section">
                    <div class="section-header">
                        <i class="fas fa-cog"></i> Configuration
                    </div>
                    <div class="section-content">
                        <p class="info-text" id="config-status">Configure your API settings to get started.</p>
                        <div id="cloudflare-status" class="cf-status">
                            <i class="fas fa-cloud"></i>
                            <span>Checking Cloudflare environment variable...</span>
                        </div>
                        <div class="api-config-form">
                            <div class="form-group">
                                <label for="api-key-input">API Key</label>
                                <input type="password" id="api-key-input" placeholder="Enter your API key">
                            </div>
                            <div class="form-group">
                                <label for="endpoint-input">API Endpoint</label>
                                <input type="text" id="endpoint-input" value="https://openrouter.ai/api/v1/chat/completions" placeholder="Enter API endpoint">
                            </div>
                            <div class="form-group">
                                <label for="model-input">Model Name</label>
                                <input type="text" id="model-input" value="deepseek/deepseek-chat-v3.1:free" placeholder="Enter model name">
                            </div>
                            <button id="save-config">Save Configuration</button>
                        </div>
                    </div>
                </div>
                
                <div class="sidebar-section">
                    <div class="section-header">
                        <i class="fas fa-info-circle"></i> Information
                    </div>
                    <div class="section-content">
                        <div class="info-text">
                            <p>This chat interface can connect to various AI APIs. By default, it uses the OpenRouter API, but you can change the endpoint to use other services.</p>
                            <p>Get your OpenRouter API key from <a href="https://openrouter.ai/keys" target="_blank">https://openrouter.ai/keys</a></p>
                            <p>Popular API endpoints:</p>
                            <ul>
                                <li><code>https://openrouter.ai/api/v1/chat/completions</code> - OpenRouter</li>
                                <li><code>https://api.deepinfra.com/v1/openai/chat/completions</code> - DeepInfra</li>
                            </ul>
                            <p>Some popular models you can try:</p>
                            <ul>
                                <li><code>deepseek/deepseek-chat-v3.1:free</code> - DeepSeek v3.1 - OpenRouter</li>
                                <li><code>meta-llama/llama-3.3-70b-instruct:free</code> - Meta: Llama 3.3 70B - OpenRouter</li>
                                <li><code>cognitivecomputations/dolphin-mistral-24b-venice-edition:free</code> - Venice: Uncensored - OpenRouter</li>
                                <li><code>deepseek-ai/DeepSeek-V3</code> - DeepSeek V3 - DeepInfra</li>
                                <li><code>meta-llama/Llama-4-Scout-17B-16E-Instruct</code> - Llama 4 Scout 17B - DeepInfra</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <header>
                <h1><i class="fas fa-robot logo"></i> Adam's AI UI</h1>
                <div class="subtitle">Powered by OpenRouter API</div>
                <div class="api-status">
                    <span class="status-dot" id="status-dot"></span>
                    <span id="status-text">Checking API</span>
                </div>
            </header>
            
            <div class="chat-container" id="chat-container">
                <div class="message ai-message">
                    <div class="message-content">
                        <i class="fas fa-robot"></i> Hello! I'm an AI assistant powered by OpenRouter. How can I help you today?
                    </div>
                    <span class="message-info">Model: <span id="current-model">deepseek/deepseek-chat-v3.1:free</span></span>
                </div>
            </div>
            
            <div class="typing-indicator" id="typing-indicator">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
                <span id="typing-model">AI is typing...</span>
            </div>
            
            <!-- Document Upload Area -->
            <div class="document-upload">
                <div class="upload-header" id="upload-toggle">
                    <div class="upload-title">
                        <i class="fas fa-file-upload"></i>
                        <span>Document Upload</span>
                    </div>
                    <i class="fas fa-chevron-down" id="upload-chevron"></i>
                </div>
                
                <div class="upload-content" id="upload-content">
                    <div class="drop-area" id="drop-area">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <div class="drop-text">Drag & drop files here or click to browse</div>
                        <input type="file" id="file-input" class="file-input" multiple accept=".txt,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.csv,.html,.xml,.json,.yaml,.yml,.js,.py,.java,.cpp,.c,.cs,.php,.rb,.go,.rs,.ts,.css,.md">
                        <button class="browse-btn" id="browse-btn">Browse Files</button>
                    </div>
                    
                    <div class="file-preview" id="file-preview">
                        <!-- Files will be previewed here -->
                    </div>
                </div>
            </div>
            
            <div class="input-container">
                <input type="text" id="user-input" placeholder="Type your message or question about the uploaded files..." autocomplete="off" disabled>
                <button id="send-button" disabled>
                    <i class="fas fa-paper-plane"></i> Send
                </button>
            </div>
            
            <div class="controls">
                <button id="clear-chat">
                    <i class="fas fa-trash"></i> Clear Chat
                </button>
                <button id="save-pdf">
                    <i class="fas fa-file-pdf"></i> Save as PDF
                </button>
                <button id="view-sessions">
                    <i class="fas fa-history"></i> Chat Sessions
                </button>
            </div>
        </div>
    </div>

    <div id="pdf-loading" class="pdf-loading">
        <div class="spinner"></div>
        <p>Generating PDF, please wait...</p>
    </div>

    <script>
        // Initialize jsPDF
        const { jsPDF } = window.jspdf;
        
        document.addEventListener('DOMContentLoaded', function() {
            const chatContainer = document.getElementById('chat-container');
            const userInput = document.getElementById('user-input');
            const sendButton = document.getElementById('send-button');
            const typingIndicator = document.getElementById('typing-indicator');
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');
            const configStatus = document.getElementById('config-status');
            const apiKeyInput = document.getElementById('api-key-input');
            const modelInput = document.getElementById('model-input');
            const endpointInput = document.getElementById('endpoint-input');
            const saveConfigButton = document.getElementById('save-config');
            const currentModelElement = document.getElementById('current-model');
            const typingModelElement = document.getElementById('typing-model');
            const cloudflareStatus = document.getElementById('cloudflare-status');
            const clearChatButton = document.getElementById('clear-chat');
            const savePdfButton = document.getElementById('save-pdf');
            const viewSessionsButton = document.getElementById('view-sessions');
            const pdfLoading = document.getElementById('pdf-loading');
            const sidebar = document.getElementById('sidebar');
            const toggleSidebarButton = document.getElementById('toggle-sidebar');
            
            // Document upload elements
            const uploadToggle = document.getElementById('upload-toggle');
            const uploadContent = document.getElementById('upload-content');
            const uploadChevron = document.getElementById('upload-chevron');
            const dropArea = document.getElementById('drop-area');
            const fileInput = document.getElementById('file-input');
            const browseBtn = document.getElementById('browse-btn');
            const filePreview = document.getElementById('file-preview');
            
            // API configuration
            let API_URL = 'https://openrouter.ai/api/v1/chat/completions';
            let API_KEY = '';
            let MODEL_NAME = 'deepseek/deepseek-chat-v3.1:free';
            
            // Track if Highlight.js is available
            let hljsAvailable = false;
            
            // Uploaded files
            let uploadedFiles = [];
            
            // Conversation history
            let conversationHistory = [
                {
                    role: 'system',
                    content: 'You are a helpful AI assistant. Format your responses using Markdown for better readability. Use code blocks for code snippets. When users upload files, help them analyze the content of those files.'
                }
            ];
            
            // Check if Highlight.js is loaded and available
            function checkHljsAvailability() {
                if (typeof hljs !== 'undefined' && hljs !== null) {
                    hljsAvailable = true;
                    console.log('Highlight.js is available');
                } else {
                    hljsAvailable = false;
                    console.warn('Highlight.js is not available, using fallback styling');
                    // Add a warning message to the chat
                    addMessage('Note: Code syntax highlighting is currently unavailable. Code will be displayed with basic formatting.', 'ai');
                }
            }
            
            // Configure marked to render code blocks with syntax highlighting
            marked.setOptions({
                highlight: function(code, lang) {
                    if (hljsAvailable && lang && hljs.getLanguage(lang)) {
                        try {
                            return hljs.highlight(code, { language: lang }).value;
                        } catch (e) {
                            console.error('Error highlighting code:', e);
                            return hljs.highlightAuto(code).value;
                        }
                    } else if (hljsAvailable) {
                        return hljs.highlightAuto(code).value;
                    } else {
                        // Fallback: just escape HTML and return plain code
                        return code.replace(/&/g, '&amp;')
                                   .replace(/</g, '&lt;')
                                   .replace(/>/g, '&gt;')
                                   .replace(/"/g, '&quot;')
                                   .replace(/'/g, '&#039;');
                    }
                }
            });

            
            // Add copy buttons to code blocks
            function addCopyButtonsToCodeBlocks() {
                document.querySelectorAll('.message-content pre').forEach((preElement) => {
                    // Check if this pre element already has a copy button
                    if (preElement.querySelector('.copy-button')) {
                        return;
                    }
                    
                    const copyButton = document.createElement('button');
                    copyButton.className = 'copy-button';
                    copyButton.innerHTML = '<i class="fas fa-copy"></i> Copy';
                    copyButton.title = 'Copy code to clipboard';
                    
                    copyButton.addEventListener('click', function() {
                        const codeElement = preElement.querySelector('code');
                        const codeToCopy = codeElement ? codeElement.textContent : preElement.textContent;
                        
                        navigator.clipboard.writeText(codeToCopy).then(() => {
                            copyButton.innerHTML = '<i class="fas fa-check"></i> Copied!';
                            copyButton.classList.add('copied');
                            
                            setTimeout(() => {
                                copyButton.innerHTML = '<i class="fas fa-copy"></i> Copy';
                                copyButton.classList.remove('copied');
                            }, 2000);
                        }).catch(err => {
                            console.error('Failed to copy code: ', err);
                            copyButton.innerHTML = '<i class="fas fa-times"></i> Failed';
                            
                            setTimeout(() => {
                                copyButton.innerHTML = '<i class="fas fa-copy"></i> Copy';
                            }, 2000);
                        });
                    });
                    
                    preElement.appendChild(copyButton);
                    
                    // Check if this is HTML code and add a run button
                    const codeElement = preElement.querySelector('code');
                    if (codeElement) {
                        const codeText = codeElement.textContent;
                        // Check if the code contains HTML tags
                        if (codeText.match(/<\/?[a-z][\s\S]*>/i)) {
                            // Add a run button for HTML code
                            const runButton = document.createElement('button');
                            runButton.className = 'run-button';
                            runButton.innerHTML = '<i class="fas fa-play"></i> Run';
                            runButton.title = 'Run HTML code in new tab';
                            
                            runButton.addEventListener('click', function() {
                                runHtmlCode(codeText);
                            });
                            
                            preElement.appendChild(runButton);
                        }
                    }
                });
            }
            
            // Function to run HTML code in a new tab
            function runHtmlCode(htmlCode) {
                // Create a new blob with the HTML content
                const blob = new Blob([htmlCode], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                
                // Open the HTML in a new tab
                window.open(url, '_blank');
                
                // Clean up the URL object after a short delay
                setTimeout(() => {
                    URL.revokeObjectURL(url);
                }, 1000);
            }
            
            // Save conversation as PDF
            async function saveAsPDF() {
                // Show loading indicator
                pdfLoading.style.display = 'flex';
                
                try {
                    // Create a new PDF document
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const pageWidth = pdf.internal.pageSize.getWidth();
                    const margin = 20;
                    const contentWidth = pageWidth - (margin * 2);
                    let yPosition = margin;
                    
                    // Add title
                    pdf.setFontSize(20);
                    pdf.setFont(undefined, 'bold');
                    pdf.setTextColor(99, 102, 241); // Primary color
                    pdf.text('Adam\'s AI UI Conversation', pageWidth / 2, yPosition, { align: 'center' });
                    yPosition += 15;
                    
                    // Add date and model info
                    pdf.setFontSize(12);
                    pdf.setFont(undefined, 'normal');
                    pdf.setTextColor(0, 0, 0);
                    const date = new Date().toLocaleString();
                    pdf.text(`Date: ${date}`, margin, yPosition);
                    yPosition += 8;
                    pdf.text(`Model: ${MODEL_NAME}`, margin, yPosition);
                    yPosition += 8;
                    pdf.text(`Total Messages: ${conversationHistory.length - 1}`, margin, yPosition);
                    yPosition += 15;
                    
                    // Add a line separator
                    pdf.setDrawColor(200, 200, 200);
                    pdf.line(margin, yPosition, pageWidth - margin, yPosition);
                    yPosition += 10;
                    
                    // Set font for messages
                    pdf.setFontSize(11);
                    
                    // Add conversation messages
                    for (const message of conversationHistory) {
                        if (message.role === 'system') continue;
                        
                        // Check if we need a new page
                        if (yPosition > 250) {
                            pdf.addPage();
                            yPosition = margin;
                        }
                        
                        // Set message background color
                        if (message.role === 'user') {
                            pdf.setFillColor(99, 102, 241); // Primary color
                            pdf.setTextColor(255, 255, 255);
                        } else {
                            pdf.setFillColor(243, 244, 246); // Secondary color
                            pdf.setTextColor(0, 0, 0);
                        }
                        
                        // Split message into lines that fit the page width
                        const messageLines = pdf.splitTextToSize(message.content, contentWidth - 20);
                        
                        // Calculate message height
                        const lineHeight = 7;
                        const messageHeight = messageLines.length * lineHeight + 10;
                        
                        // Draw message background
                        pdf.roundedRect(margin, yPosition, contentWidth, messageHeight, 3, 3, 'F');
                        
                        // Add message text
                        pdf.text(messageLines, margin + 10, yPosition + 10);
                        
                        // Add sender label
                        pdf.setFont(undefined, 'bold');
                        if (message.role === 'user') {
                            pdf.text('User', margin + 10, yPosition + 5);
                        } else {
                            pdf.text('AI Assistant', margin + 10, yPosition + 5);
                        }
                        pdf.setFont(undefined, 'normal');
                        
                        // Update Y position for next message
                        yPosition += messageHeight + 10;
                    }
                    
                    // Add page numbers
                    const totalPages = pdf.internal.getNumberOfPages();
                    for (let i = 1; i <= totalPages; i++) {
                        pdf.setPage(i);
                        pdf.setFontSize(10);
                        pdf.setTextColor(100, 100, 100);
                        pdf.text(`Page ${i} of ${totalPages}`, pageWidth - margin, pdf.internal.pageSize.getHeight() - 10, { align: 'right' });
                    }
                    
                    // Save the PDF
                    const dateStr = new Date().toISOString().slice(0, 10);
                    pdf.save(`Adams-AI-UI-${dateStr}.pdf`);
                    
                } catch (error) {
                    console.error('Error generating PDF:', error);
                    alert('Error generating PDF. Please try again.');
                } finally {
                    // Hide loading indicator
                    pdfLoading.style.display = 'none';
                }
            }
            
            // Toggle sidebar visibility
            function toggleSidebar() {
                sidebar.classList.toggle('collapsed');
                
                // Update button icon
                const icon = toggleSidebarButton.querySelector('i');
                if (sidebar.classList.contains('collapsed')) {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-chevron-right');
                } else {
                    icon.classList.remove('fa-chevron-right');
                    icon.classList.add('fa-bars');
                }
                
                // Save sidebar state to localStorage
                localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
            }
            
            // Toggle upload area visibility
            function toggleUploadArea() {
                uploadContent.classList.toggle('expanded');
                
                // Update chevron icon
                if (uploadContent.classList.contains('expanded')) {
                    uploadChevron.classList.remove('fa-chevron-down');
                    uploadChevron.classList.add('fa-chevron-up');
                } else {
                    uploadChevron.classList.remove('fa-chevron-up');
                    uploadChevron.classList.add('fa-chevron-down');
                }
            }
            
            // Check for Cloudflare Pages environment variable
            function checkCloudflareEnv() {
                // This will be replaced at build time by Cloudflare Pages
                // The variable needs to be injected into the HTML during build
                const cfApiKey = '{{API_KEY}}';
                
                if (cfApiKey && cfApiKey !== '{{API_KEY}}' && cfApiKey.length > 10) {
                    // Valid Cloudflare environment variable found
                    API_KEY = cfApiKey;
                    cloudflareStatus.innerHTML = `<i class="fas fa-check-circle"></i> <span>Using API key from Cloudflare environment variable: <code>${cfApiKey.substring(0, 10)}...</code></span>`;
                    cloudflareStatus.classList.add('success');
                    return true;
                } else {
                    // No valid Cloudflare environment variable found - hide the status
                    cloudflareStatus.style.display = 'none';
                    return false;
                }
            }
            
            // Initialize the app
            function initializeConfig() {
                // Load sidebar state from localStorage
                const sidebarCollapsed = localStorage.getItem('sidebarCollapsed');
                if (sidebarCollapsed === 'true') {
                    sidebar.classList.add('collapsed');
                    const icon = toggleSidebarButton.querySelector('i');
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-chevron-right');
                }
                
                const cloudflareResult = checkCloudflareEnv();
                
                // Check localStorage for model name
                const savedModel = localStorage.getItem('openrouter_model');
                
                // Check localStorage for endpoint
                const savedEndpoint = localStorage.getItem('api_endpoint');
                if (savedEndpoint) {
                    API_URL = savedEndpoint;
                    endpointInput.value = savedEndpoint;
                }
                if (savedModel) {
                    MODEL_NAME = savedModel;
                    modelInput.value = savedModel;
                    currentModelElement.textContent = savedModel;
                    typingModelElement.textContent = `${savedModel.split('/').pop()} is typing...`;
                }
                
                // Check localStorage for API key if Cloudflare didn't provide one
                const savedApiKey = localStorage.getItem('openrouter_api_key');
                if (savedApiKey) {
                    API_KEY = savedApiKey;
                    apiKeyInput.value = savedApiKey;
                    configStatus.innerHTML = `Configuration loaded from browser storage. Using model: <code>${MODEL_NAME}</code>` + 
                                            (API_KEY ? '' : '<br><span style="color: var(--warning);">Warning: No API key configured</span>');
                    updateStatus('API key loaded', true);
                    return true;
                }
                
                if (cloudflareResult) {
                    configStatus.innerHTML = `Configuration loaded from Cloudflare. Using model: <code>${MODEL_NAME}</code>` + 
                                            (API_KEY ? '' : '<br><span style="color: var(--warning);">Warning: No API key configured</span>');
                    updateStatus('API key loaded', true);
                    return true;
                }
                
                configStatus.innerHTML = 'Please configure your API settings above';
                updateStatus('API key required', false);
                
                // Add copy buttons to any existing code blocks
                setTimeout(() => {
                    addCopyButtonsToCodeBlocks();
                }, 100);
                
                return false;
            }
            
            // Update connection status UI
            function updateStatus(text, connected) {
                statusText.textContent = text;
                if (connected) {
                    statusDot.classList.add('connected');
                    statusDot.classList.remove('error');
                } else {
                    statusDot.classList.add('error');
                    statusDot.classList.remove('connected');
                }
            }
            
            // Add message to chat with markdown support
            function addMessage(text, sender, addToHistory = true) {
                const messageElement = document.createElement('div');
                messageElement.classList.add('message');
                messageElement.classList.add(sender + '-message');
                
                const messageContent = document.createElement('div');
                messageContent.classList.add('message-content');
                
                // Add sender icon
                const icon = document.createElement('i');
                icon.className = sender === 'ai' ? 'fas fa-robot' : 'fas fa-user';
                
                // Parse markdown if it's an AI message
                if (sender === 'ai') {
                    messageContent.innerHTML = marked.parse(text);
                } else {
                    messageContent.textContent = text;
                }
                
                messageElement.appendChild(icon);
                messageElement.appendChild(messageContent);
                
                // Add to chat container
                chatContainer.appendChild(messageElement);
                
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
                // Apply fallback styling if hljs is not available
                if (!hljsAvailable) {
                    messageContent.querySelectorAll('pre code').forEach((block) => {
                        block.classList.add('hljs-fallback');
                    });
                } else {
                    // Highlight any code blocks in the message
                    messageContent.querySelectorAll('pre code').forEach((block) => {
                        hljs.highlightElement(block);
                    });
                }
                
                // Add copy buttons to code blocks
                setTimeout(() => {
                    addCopyButtonsToCodeBlocks();
                }, 100);
                
                // Add to conversation history
                if (addToHistory) {
                    if (sender === 'user') {
                        conversationHistory.push({ role: 'user', content: text });
                    } else if (sender === 'ai') {
                        conversationHistory.push({ role: 'assistant', content: text });
                    }
                }
            }
            
            // Show/hide typing indicator
            function setTyping(visible) {
                typingIndicator.classList.toggle('active', visible);
                if (visible) {
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }
            }
            
            // Read file content
            function readFileContent(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    
                    reader.onload = (event) => {
                        resolve({
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            content: event.target.result
                        });
                    };
                    
                    reader.onerror = (error) => {
                        reject(error);
                    };
                    
                    // Read based on file type
                    if (file.type.includes('text') || file.type === 'application/json' || 
                        file.name.endsWith('.yml') || file.name.endsWith('.yaml') ||
                        file.name.endsWith('.js') || file.name.endsWith('.py') ||
                        file.name.endsWith('.java') || file.name.endsWith('.cpp') ||
                        file.name.endsWith('.c') || file.name.endsWith('.cs') ||
                        file.name.endsWith('.php') || file.name.endsWith('.rb') ||
                        file.name.endsWith('.go') || file.name.endsWith('.rs') ||
                        file.name.endsWith('.ts') || file.name.endsWith('.css') ||
                        file.name.endsWith('.html') || file.name.endsWith('.xml') ||
                        file.name.endsWith('.md')) {
                        reader.readAsText(file);
                    } else {
                        // For binary files, just note their presence
                        resolve({
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            content: null
                        });
                    }
                });
            }
            
            // Process uploaded files and add to conversation
            async function processUploadedFiles() {
                if (uploadedFiles.length === 0) return '';
                
                let fileContents = 'I have uploaded the following files:\n';
                
                for (const file of uploadedFiles) {
                    try {
                        const fileData = await readFileContent(file);
                        
                        if (fileData.content) {
                            // For text files, include the content
                            fileContents += `\n--- ${fileData.name} ---\n${fileData.content}\n`;
                        } else {
                            // For binary files, just note their presence
                            fileContents += `\n--- ${fileData.name} ---\n(Binary file - ${fileData.type}, ${formatFileSize(fileData.size)})\n`;
                        }
                    } catch (error) {
                        console.error('Error reading file:', error);
                        fileContents += `\n--- ${file.name} ---\n(Error reading file)\n`;
                    }
                }
                
                return fileContents;
            }
            
            // Format file size
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            // Send message to API
            async function sendMessage() {
                const message = userInput.value.trim();
                if (!message && uploadedFiles.length === 0) return;
                
                // Process uploaded files
                const fileContents = await processUploadedFiles();
                
                // Combine user message with file contents
                const fullMessage = message + (fileContents ? `\n\n${fileContents}` : '');
                
                // Add user message to chat
                addMessage(fullMessage, 'user');
                userInput.value = '';
                sendButton.disabled = true;
                setTyping(true);
                
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${API_KEY}`,
                            'HTTP-Referer': window.location.href,
                            'X-Title': 'Adam\'s AI UI'
                        },
                        body: JSON.stringify({
                            model: MODEL_NAME,
                            messages: [
                                {
                                    role: 'system',
                                    content: 'You are a helpful AI assistant. Analyze the content of any uploaded files and provide helpful responses based on the file content. Format your responses using Markdown for better readability. Use code blocks for code snippets.'
                                },
                                ...conversationHistory.filter(msg => msg.role !== 'system'),
                                { role: 'user', content: fullMessage }
                            ]
                        })
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || `API error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    const aiResponse = data.choices[0].message.content;

                    setTyping(false);
                    addMessage(aiResponse, 'ai');
                    updateStatus('Response received', true);
                    
                    // Clear uploaded files after successful processing
                    uploadedFiles = [];
                    renderFilePreviews();
                } catch (error) {
                    setTyping(false);
                    addMessage(`Error: ${error.message}. Please check your API key and try again.`, 'ai');
                    updateStatus('API error', false);
                    console.error('Error:', error);
                }
                
                sendButton.disabled = false;
                userInput.focus();
            }
            
            // Save configuration
            function saveConfig() {
                const key = apiKeyInput.value.trim();
                const endpoint = endpointInput.value.trim();
                const model = modelInput.value.trim();
                          
                if (!endpoint) {
                    alert('Please enter an API endpoint');
                    return;
                }
                
                // API key is optional, but show warning if empty
                if (!key) {
                    if (!confirm('Warning: No API key provided. Some endpoints may not work without authentication. Continue anyway?')) {
                        return;
                    }
                }
                
                API_KEY = key;
                API_URL = endpoint;
                MODEL_NAME = model;
                
                localStorage.setItem('openrouter_api_key', key);
                localStorage.setItem('api_endpoint', endpoint);
                localStorage.setItem('openrouter_model', model);
                
                currentModelElement.textContent = model;
                typingModelElement.textContent = `${model.split('/').pop()} is typing...`;
                configStatus.innerHTML = `Configuration saved. Using model: <code>${model}</code>` + 
                                        (key ? '' : '<br><span style="color: var(--warning);">Warning: No API key configured</span>');
                
                // Update the status to show API key is loaded
                updateStatus('API key loaded', true);
                
                // Enable the chat input
                userInput.disabled = false;
                sendButton.disabled = false;
                userInput.focus();
                
                // Add a confirmation message
                addMessage('Configuration saved successfully. You can now start chatting!', 'ai');
            }
            
            // Clear chat history
            function clearChat() {
                if (confirm('Are you sure you want to clear the conversation history?')) {
                    conversationHistory = [
                        {
                            role: 'system',
                            content: 'You are a helpful AI assistant. Format your responses using Markdown for better readability. Use code blocks for code snippets. When users upload files, help them analyze the content of those files.'
                        }
                    ];
                    
                    // Clear uploaded files
                    uploadedFiles = [];
                    renderFilePreviews();
                    
                    // Clear the chat container except for the first message
                    while (chatContainer.children.length > 1) {
                        chatContainer.removeChild(chatContainer.lastChild);
                    }
                    
                    addMessage('Conversation history has been cleared.', 'ai');
                }
            }
            
            // Handle file uploads
            function handleFiles(files) {
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    
                    // Check if file is already uploaded
                    if (!uploadedFiles.some(f => f.name === file.name && f.size === file.size && f.type === file.type)) {
                        uploadedFiles.push(file);
                    }
                }
                
                renderFilePreviews();
            }
            
            // Render file previews
            function renderFilePreviews() {
                filePreview.innerHTML = '';
                
                if (uploadedFiles.length === 0) {
                    return;
                }
                
                uploadedFiles.forEach((file, index) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    
                    // Get file icon based on type
                    let fileIcon = 'file';
                    if (file.type.includes('image')) fileIcon = 'file-image';
                    else if (file.type.includes('pdf')) fileIcon = 'file-pdf';
                    else if (file.type.includes('word')) fileIcon = 'file-word';
                    else if (file.type.includes('excel')) fileIcon = 'file-excel';
                    else if (file.type.includes('powerpoint')) fileIcon = 'file-powerpoint';
                    else if (file.type.includes('text') || file.type.includes('json') || 
                             file.name.endsWith('.yml') || file.name.endsWith('.yaml')) fileIcon = 'file-alt';
                    else if (file.type.includes('zip')) fileIcon = 'file-archive';
                    else if (file.name.endsWith('.js')) fileIcon = 'file-code';
                    else if (file.name.endsWith('.py')) fileIcon = 'file-code';
                    else if (file.name.endsWith('.java')) fileIcon = 'file-code';
                    else if (file.name.endsWith('.cpp') || file.name.endsWith('.c')) fileIcon = 'file-code';
                    else if (file.name.endsWith('.cs')) fileIcon = 'file-code';
                    else if (file.name.endsWith('.php')) fileIcon = 'file-code';
                    else if (file.name.endsWith('.rb')) fileIcon = 'file-code';
                    else if (file.name.endsWith('.go')) fileIcon = 'file-code';
                    else if (file.name.endsWith('.rs')) fileIcon = 'file-code';
                    else if (file.name.endsWith('.ts')) fileIcon = 'file-code';
                    else if (file.name.endsWith('.css')) fileIcon = 'file-code';
                    else if (file.name.endsWith('.html')) fileIcon = 'file-code';
                    else if (file.name.endsWith('.xml')) fileIcon = 'file-code';
                    else if (file.name.endsWith('.md')) fileIcon = 'file-alt';
                    
                    // Format file size
                    const fileSize = formatFileSize(file.size);
                    
                    fileItem.innerHTML = `
                        <div class="file-info">
                            <div class="file-icon">
                                <i class="fas fa-${fileIcon}"></i>
                            </div>
                            <div class="file-details">
                                <div class="file-name">${file.name}</div>
                                <div class="file-size">${fileSize}</div>
                            </div>
                        </div>
                        <button class="file-remove" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    filePreview.appendChild(fileItem);
                });
                
                // Add event listeners to remove buttons
                document.querySelectorAll('.file-remove').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const index = parseInt(button.dataset.index);
                        uploadedFiles.splice(index, 1);
                        renderFilePreviews();
                    });
                });
                
                // Update input placeholder
                userInput.placeholder = "Type your question about the uploaded files...";
            }
            
            // Event listeners
            sendButton.addEventListener('click', sendMessage);
            saveConfigButton.addEventListener('click', saveConfig);
            clearChatButton.addEventListener('click', clearChat);
            toggleSidebarButton.addEventListener('click', toggleSidebar);
            savePdfButton.addEventListener('click', saveAsPDF);
            uploadToggle.addEventListener('click', toggleUploadArea);
            browseBtn.addEventListener('click', () => fileInput.click());
            
            // File input change event
            fileInput.addEventListener('change', (e) => {
                handleFiles(e.target.files);
                // Reset file input
                fileInput.value = '';
            });
            
            // Drag and drop events
            dropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropArea.classList.add('active');
            });
            
            dropArea.addEventListener('dragleave', () => {
                dropArea.classList.remove('active');
            });
            
            dropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                dropArea.classList.remove('active');
                
                if (e.dataTransfer.files.length > 0) {
                    handleFiles(e.dataTransfer.files);
                }
            });
            
            // Click on drop area to open file browser
            dropArea.addEventListener('click', () => {
                fileInput.click();
            });
            
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            apiKeyInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    saveConfig();
                }
            });
            
            modelInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    saveConfig();
                }
            });

                        
            endpointInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    saveConfig();
                }
            });
            
            // Initialize the app
            initializeConfig();
            checkApiKey();
            checkHljsAvailability();
        });
    </script>
</body>
</html>
